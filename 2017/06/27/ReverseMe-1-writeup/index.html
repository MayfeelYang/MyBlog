<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="记录生活点滴"><title>ReverseMe#1学习笔记 | 菜鸟の日常</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/MyBlog/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/MyBlog/favicon.ico"><link rel="apple-touch-icon" href="/MyBlog/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/MyBlog/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">ReverseMe#1学习笔记</h1><a id="logo" href="/MyBlog/.">菜鸟の日常</a><p class="description">呆到深处自然萌~</p></div><div id="nav-menu"><a href="/MyBlog/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/MyBlog/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/MyBlog/about/"><i class="fa fa-user"> 关于</i></a><a href="/MyBlog/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">ReverseMe#1学习笔记</h1><div class="post-meta">Jun 27, 2017<span> | </span><span class="category"><a href="/MyBlog/categories/逆向-利用/">逆向&amp;利用</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ReverseMe-1笔记"><span class="toc-number">1.</span> <span class="toc-text">ReverseMe#1笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#程序下载地址"><span class="toc-number">1.1.</span> <span class="toc-text">程序下载地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#题目要求"><span class="toc-number">1.2.</span> <span class="toc-text">题目要求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#运行程序"><span class="toc-number">1.3.</span> <span class="toc-text">运行程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#解题"><span class="toc-number">1.4.</span> <span class="toc-text">解题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#效果展示"><span class="toc-number">1.5.</span> <span class="toc-text">效果展示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-number">1.6.</span> <span class="toc-text">参考</span></a></li></ol></li></ol></div></div><div class="post-content"><h1 id="ReverseMe-1笔记"><a href="#ReverseMe-1笔记" class="headerlink" title="ReverseMe#1笔记"></a>ReverseMe#1笔记</h1><h2 id="程序下载地址"><a href="#程序下载地址" class="headerlink" title="程序下载地址"></a>程序下载地址</h2><p><a href="http://reteam.org/ID-RIP/database/santmat/rm1.zip" target="_blank" rel="external">http://reteam.org/ID-RIP/database/santmat/rm1.zip</a></p>
<h2 id="题目要求"><a href="#题目要求" class="headerlink" title="题目要求"></a>题目要求</h2><p>一个邪恶博士手里有这个发射原子弹的程序,你不能完全破坏这个程序,必须给它加上一个口令,使邪恶博士不能进入</p>
<h2 id="运行程序"><a href="#运行程序" class="headerlink" title="运行程序"></a>运行程序</h2><p>首先会蹦出题目要求的窗口<br><img src="/MyBlog/2017/06/27/ReverseMe-1-writeup/14984593586822.jpg" alt=""><br>点击“Continue to the Program”后会出现：<br><img src="/MyBlog/2017/06/27/ReverseMe-1-writeup/14984593913728.jpg" alt=""><br>“Nuke the World!!!”就是发射导弹，“Exit the Program”就是退出程序。</p>
<h2 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h2><p>使用IDA查看反汇编，找到关键代码，发现弹出窗口使用“CreateWindowExA”函数实现。<br><img src="/MyBlog/2017/06/27/ReverseMe-1-writeup/14984596877098.jpg" alt=""><br>msdn对该函数的解释：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function">HWND WINAPI <span class="title">CreateWindowEx</span><span class="params">(</span></span></div><div class="line">  _In_     DWORD     dwExStyle,</div><div class="line">  _In_opt_ LPCTSTR   lpClassName,</div><div class="line">  _In_opt_ LPCTSTR   lpWindowName,</div><div class="line">  _In_     DWORD     dwStyle,</div><div class="line">  _In_     <span class="keyword">int</span>       x,</div><div class="line">  _In_     <span class="keyword">int</span>       y,</div><div class="line">  _In_     <span class="keyword">int</span>       nWidth,</div><div class="line">  _In_     <span class="keyword">int</span>       nHeight,</div><div class="line">  _In_opt_ HWND      hWndParent,</div><div class="line">  _In_opt_ HMENU     hMenu,</div><div class="line">  _In_opt_ HINSTANCE hInstance,</div><div class="line">  _In_opt_ LPVOID    lpParam</div><div class="line">);</div></pre></td></tr></table></figure>
<p>其中含有<code>dwStyle</code>，其取值可参考链接：<a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ff700543(v=vs.85).aspx" target="_blank" rel="external">https://msdn.microsoft.com/en-us/library/windows/desktop/ff700543(v=vs.85).aspx</a></p>
<p>这里将<code>50000804</code>改为<code>50800080</code>，是Edit可写。</p>
<p>下一步,想想要进行口令检验用什么函数，从文本框取字串要用<code>GetWindowText</code>，字串比较用<code>lstrcmp</code>。先别着急翻输入表加函数，原来程序已经有这两个函数了：<br><img src="/MyBlog/2017/06/27/ReverseMe-1-writeup/14984603645803.jpg" alt=""></p>
<p>且反汇编代码中有一些敏感的地方，可以关注：<br><img src="/MyBlog/2017/06/27/ReverseMe-1-writeup/14985401831804.jpg" alt=""></p>
<p>在<code>4013bc</code>处的<code>0x111</code>就是敏感点，它是<code>WM_COMMAND</code>的宏定义，msdn是这样解释的：</p>
<blockquote>
<p>Sent when the user selects a command item from a menu, when a control sends a notification message to its parent window, or when an accelerator keystroke is translated.</p>
</blockquote>
<p>同时，在<code>401401</code>处还有<code>DestroyWindow</code>函数，明显是那个按钮按下后的动作。<br>在<code>4013e4</code>处使用了一个<code>hWnd</code>，其对应了程序<code>4011ca</code>处的<code>hWnd</code>。<br><img src="/MyBlog/2017/06/27/ReverseMe-1-writeup/14985404421995.jpg" alt=""><br>修改这个Edit的<code>dwStyle</code>的值就可以了，将<code>50000804</code>改为<code>50800080</code>。<br>后续的代码中还有<code>ExitProcess</code>函数，这个函数也是后面需要用到的。<br><img src="/MyBlog/2017/06/27/ReverseMe-1-writeup/14985402949936.jpg" alt=""></p>
<p>使用petools查看pe相关信息：<br><img src="/MyBlog/2017/06/27/ReverseMe-1-writeup/14985410611547.jpg" alt=""></p>
<p>当程序运行到上述的GetWindowTextA附近的时候，使用<code>jmp</code>语句改写控制流，如下<code>4013da</code>：<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">:004013BC 817D0C11010000          <span class="keyword">cmp</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">ebp</span>+0C], <span class="number">00000111</span></div><div class="line">:004013C3 0F8586000000            <span class="keyword">jne</span> 0040144F</div><div class="line">:004013C9 8B4510                  <span class="keyword">mov</span> <span class="built_in">eax</span>, <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">ebp</span>+<span class="number">10</span>]</div><div class="line">:004013CC 6683F801                <span class="keyword">cmp</span> <span class="built_in">ax</span>, <span class="number">0001</span></div><div class="line">:004013D0 <span class="number">7545</span>                    <span class="keyword">jne</span> <span class="number">00401417</span></div><div class="line">:004013D2 C1E810                  <span class="keyword">shr</span> <span class="built_in">eax</span>, <span class="number">10</span></div><div class="line">:004013D5 660BC0                  <span class="keyword">or</span> <span class="built_in">ax</span>, <span class="built_in">ax</span></div><div class="line">:004013D8 <span class="number">753D</span>                    <span class="keyword">jne</span> <span class="number">00401417</span></div><div class="line">:004013DA E9D3010000              <span class="keyword">jmp</span> 004015B2  &lt;-强行跳转到后面</div><div class="line">:004013DF <span class="number">6828344000</span>              <span class="keyword">push</span> <span class="number">00403428</span></div><div class="line">:004013E4 FF3500344000            <span class="keyword">push</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="number">00403400</span>]</div></pre></td></tr></table></figure></p>
<p><img src="/MyBlog/2017/06/27/ReverseMe-1-writeup/14985270148605.jpg" alt=""><br>改变控制流，使程序跳转到<code>.text</code>段最后的自己添加的代码的位置。</p>
<p><code>.text</code>段的末尾添加的代码如下：<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">:<span class="number">004015B2</span> <span class="number">6800020000</span>              <span class="built_in">push</span> <span class="number">00000200</span>  &lt;-最大字符数</div><div class="line">:<span class="number">004015B7</span> <span class="number">6828344000</span>              <span class="built_in">push</span> <span class="number">00403428</span>  &lt;-字符保存地址</div><div class="line">:<span class="number">004015BC</span> FF3500344000            <span class="built_in">push</span> dword ptr [<span class="number">00403400</span>] &lt;-EDIT的句柄</div><div class="line">:<span class="number">004015C2</span> E8B5FFFFFF              call <span class="number">0040157C</span>  &lt;-得到字串 GetWindowTextA</div><div class="line">:<span class="number">004015C7</span> 68F0234000              <span class="built_in">push</span> <span class="number">004023F0</span>  &lt;-自定义的密码</div><div class="line">:<span class="number">004015CC</span> <span class="number">6828344000</span>              <span class="built_in">push</span> <span class="number">00403428</span>  &lt;-文本框里的字串 </div><div class="line">:<span class="number">004015D1</span> E882FFFFFF              call <span class="number">00401558</span>  &lt;-如果相同则EAX=<span class="number">0</span> lstrcmpA</div><div class="line">:<span class="number">004015D6</span> 85C0                    test eax, eax</div><div class="line">:<span class="number">004015D8</span> <span class="number">0F8420FEFFFF</span>            je <span class="number">004013FE</span>    &lt;-如果EAX=<span class="number">0</span>即密码正确就跳回去继续执行</div><div class="line">:<span class="number">004015DE</span> 6A00                    <span class="built_in">push</span> <span class="number">00000000</span></div><div class="line">:<span class="number">004015E0</span> FF1508204000            call dword ptr [<span class="number">00402008</span>] &lt;-密码不正确就直接退出 KERNEL32.ExitProcess</div><div class="line">:<span class="number">004015E6</span> <span class="number">00000000000000000000</span>    BYTE <span class="number">10</span> DUP(<span class="number">0</span>)</div></pre></td></tr></table></figure></p>
<p><img src="/MyBlog/2017/06/27/ReverseMe-1-writeup/14985424154703.jpg" alt=""></p>
<p>自定义的密码，添加至<code>.rdata</code>段<code>4023f0</code>处。<br><img src="/MyBlog/2017/06/27/ReverseMe-1-writeup/14985423430385.jpg" alt=""></p>
<h2 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h2><p><img src="/MyBlog/2017/06/27/ReverseMe-1-writeup/14985425611697.jpg" alt=""><br>此时直接点击<code>Continue to the Program</code>将直接退出程序，只有输入<code>0123456789</code>才可以进入启动炸弹的页面。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://www.pediy.com/kssd/index.html" target="_blank" rel="external">http://www.pediy.com/kssd/index.html</a></p>
</div><script type="text/javascript" src="/MyBlog/js/share.js?v=0.0.0" async></script><a data-url="http://mayfeelyang.github.io/MyBlog/2017/06/27/ReverseMe-1-writeup/" data-id="cj5t1b6v000000gc0j595b4l4" class="article-share-link">分享到</a><div class="tags"><a href="/MyBlog/tags/ReverseMe/">ReverseMe</a><a href="/MyBlog/tags/reverse/">reverse</a></div><div class="post-nav"><a href="/MyBlog/2017/06/27/ReverseMe-1学习笔记/" class="pre">ReverseMe#1学习笔记</a><a href="/MyBlog/2017/06/14/peach监控/" class="next">peach监控</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/MyBlog/categories/CTF相关/">CTF相关</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/MyBlog/categories/Preparation-编程基础/">Preparation - 编程基础</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/MyBlog/categories/web安全/">web安全</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/MyBlog/categories/操作系统内核/">操作系统内核</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/MyBlog/categories/模式识别/">模式识别</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/MyBlog/categories/模糊测试/">模糊测试</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/MyBlog/categories/漏洞分析/">漏洞分析</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/MyBlog/categories/程序分析/">程序分析</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/MyBlog/categories/逆向-利用/">逆向&利用</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/MyBlog/tags/peach/" style="font-size: 15px;">peach</a> <a href="/MyBlog/tags/fuzz/" style="font-size: 15px;">fuzz</a> <a href="/MyBlog/tags/symbolic-execution/" style="font-size: 15px;">symbolic execution</a> <a href="/MyBlog/tags/IDA/" style="font-size: 15px;">IDA</a> <a href="/MyBlog/tags/C/" style="font-size: 15px;">C++</a> <a href="/MyBlog/tags/ELF/" style="font-size: 15px;">ELF</a> <a href="/MyBlog/tags/crash/" style="font-size: 15px;">crash</a> <a href="/MyBlog/tags/heap-buffer-overflow/" style="font-size: 15px;">heap buffer overflow</a> <a href="/MyBlog/tags/null-pointer-dereference/" style="font-size: 15px;">null pointer dereference</a> <a href="/MyBlog/tags/ReverseMe/" style="font-size: 15px;">ReverseMe</a> <a href="/MyBlog/tags/reverse/" style="font-size: 15px;">reverse</a> <a href="/MyBlog/tags/oss/" style="font-size: 15px;">oss</a> <a href="/MyBlog/tags/driller/" style="font-size: 15px;">driller</a> <a href="/MyBlog/tags/symfuzz/" style="font-size: 15px;">symfuzz</a> <a href="/MyBlog/tags/symbolic-analysis/" style="font-size: 15px;">symbolic analysis</a> <a href="/MyBlog/tags/BAP/" style="font-size: 15px;">BAP</a> <a href="/MyBlog/tags/web/" style="font-size: 15px;">web</a> <a href="/MyBlog/tags/xss-csrf/" style="font-size: 15px;">xss - csrf</a> <a href="/MyBlog/tags/zzuf/" style="font-size: 15px;">zzuf</a> <a href="/MyBlog/tags/MyHeapAllocator-堆/" style="font-size: 15px;">MyHeapAllocator - 堆</a> <a href="/MyBlog/tags/markdown/" style="font-size: 15px;">markdown</a> <a href="/MyBlog/tags/调试器/" style="font-size: 15px;">调试器</a> <a href="/MyBlog/tags/sulley/" style="font-size: 15px;">sulley</a> <a href="/MyBlog/tags/模式识别/" style="font-size: 15px;">模式识别</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/MyBlog/2017/06/27/ReverseMe-1学习笔记/">ReverseMe#1学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/MyBlog/2017/06/27/ReverseMe-1-writeup/">ReverseMe#1学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/MyBlog/2017/06/14/peach监控/">peach监控</a></li><li class="post-list-item"><a class="post-list-link" href="/MyBlog/2017/06/14/白帽子讲web安全-阅读笔记/">白帽子讲web安全-阅读笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/MyBlog/2017/06/14/Jhead-3-00-Heap-Buffer-Overflow-Vulnerability-2/">Jhead-3.00 Heap Buffer Overflow Vulnerability-2</a></li><li class="post-list-item"><a class="post-list-link" href="/MyBlog/2017/06/01/Jhead-3-00-Heap-Buffer-Overflow-Vulnerability/">Jhead-3.00 Heap Buffer Overflow Vulnerability-1</a></li><li class="post-list-item"><a class="post-list-link" href="/MyBlog/2017/05/09/简单的堆分配器-MyHeapAllocator/">简单的堆分配器-MyHeapAllocator</a></li><li class="post-list-item"><a class="post-list-link" href="/MyBlog/2017/05/09/简单的调试器-MyDebugger/">简单的调试器-MyDebugger</a></li><li class="post-list-item"><a class="post-list-link" href="/MyBlog/2017/04/10/zzuf原理及源码分析/">zzuf原理及源码分析</a></li><li class="post-list-item"><a class="post-list-link" href="/MyBlog/2017/02/14/Fuzz/sulley的架构/">sulley的架构</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/MyBlog/." rel="nofollow">菜鸟の日常.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/MyBlog/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/MyBlog/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/MyBlog/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/MyBlog/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/MyBlog/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/MyBlog/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/MyBlog/js/smartresize.js?v=0.0.0"></script></div></body></html>